#!/bin/bash
set -uexo pipefail

PARENT_DIR=$(pwd)
SCRIPT_DIR=$(dirname $(realpath "$0"))
INSTALL_PREFIX=${INSTALL_PREFIX:-}

git submodule update
cd "${SCRIPT_DIR}"
rm -rf build
mkdir build && cd build
cmake .. -GNinja \
    -DBUILD_SHARED_LIBS=ON \
    -DCMAKE_POSITION_INDEPENDENT_CODE=ON \
    -DCMAKE_INSTALL_PREFIX="${PARENT_DIR}/usr/"
ninja
ninja install

cd "${PARENT_DIR}"
